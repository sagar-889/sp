<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Turf | SportsConnect </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        .split-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            min-height: calc(100vh - 100px);
            padding: 8rem 10% 4rem;
            align-items: start;
        }

        .turf-preview {
            position: relative;
        }

        .turf-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--glass-border);
        }

        .booking-details-card {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 3rem;
            border-radius: 20px;
        }

        .price-tag {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 1rem 0 2rem;
            display: block;
        }

        .price-tag span {
            font-size: 1rem;
            color: var(--text-gray);
            font-weight: 400;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-gray);
            font-size: 1.1rem;
        }

        @media (max-width: 900px) {
            .split-layout {
                grid-template-columns: 1fr;
                padding: 6rem 5% 2rem;
            }

            .turf-image {
                height: 250px;
            }
        }
    </style>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html" class="logo">SPORTS<span>CONNECT</span></a>
        <div class="nav-links">
            <a href="dashboard-player.html">Dashboard</a>
            <a href="index.html">Logout</a>
        </div>
    </nav>

    <div class="split-layout">
        <!-- Left: Turf Info -->
        <div class="turf-description">
            <div class="turf-preview">
                <!-- Placeholder Image since we don't have real images yet -->
                <div class="turf-image"
                    style="background: linear-gradient(45deg, #1a1a1a, #2a2a2a); display: flex; align-items: center; justify-content: center; color: var(--text-gray);">
                    <i class="fas fa-image" style="font-size: 3rem;"></i>
                </div>
            </div>
            <div style="margin-top: 2rem;">
                <h1 id="turfName" style="font-size: 2.5rem; margin-bottom: 0.5rem;">Loading...</h1>
                <div class="meta-item">
                    <i class="fas fa-map-marker-alt" style="color: var(--primary-color);"></i>
                    <span id="turfLocation">Location</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-star" style="color: #ffcc00;"></i>
                    <span>4.8 (120 Reviews)</span>
                </div>
                <p style="margin-top: 1.5rem; color: var(--text-gray); line-height: 1.8;">
                    Experience professional-grade facilities. Perfect for 5v5 matches, training sessions, and corporate
                    events. Includes changing rooms, floodlights, and parking.
                </p>
            </div>
        </div>

        <!-- Right: Booking Form -->
        <div class="booking-details-card">
            <h2 style="margin-bottom: 2rem;">Book Your Slot</h2>

            <form id="bookingForm" onsubmit="handlePayment(event)">
                <div class="form-group">
                    <label class="form-label">Select Date</label>
                    <input type="date" id="bookingDate" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Select Time</label>
                    <select id="bookingTime" class="form-input" required>
                        <option value="">Choose a slot...</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="12:00">12:00 PM</option>
                        <option value="16:00">04:00 PM</option>
                        <option value="17:00">05:00 PM</option>
                        <option value="18:00">06:00 PM</option>
                        <option value="19:00">07:00 PM</option>
                        <option value="20:00">08:00 PM</option>
                    </select>
                </div>

                <div class="price-summary"
                    style="margin: 2rem 0; padding: 1.5rem; background: rgba(255,255,255,0.03); border-radius: 10px;">
                    <div
                        style="display: flex; justify-content: region; margin-bottom: 0.5rem; color: var(--text-gray);">
                        <span>Rate per hour</span>
                        <span style="font-weight: 600;" id="ratePerHour">$0</span>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--text-gray);">
                        <span>Service Fee</span>
                        <span style="font-weight: 600;">$2.00</span>
                    </div>
                    <hr style="border: 0; border-top: 1px solid var(--glass-border); margin: 1rem 0;">
                    <div
                        style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700; color: var(--text-light);">
                        <span>Total</span>
                        <span id="totalPrice">$0.00</span>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1.2rem;">
                    Pay & Book Now <i class="fas fa-lock" style="margin-left: 0.5rem; font-size: 0.9rem;"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="state.js"></script>
    <script>
        // Setup Date Input Min Value
        const dateInput = document.getElementById('bookingDate');
        const today = new Date().toISOString().split('T')[0];
        dateInput.min = today;
        dateInput.value = today;

        // Get Params
        const urlParams = new URLSearchParams(window.location.search);
        const turfId = urlParams.get('turfId');
        let currentTurf = null;

        // Load Turf Details
        function loadTurf() {
            if (!turfId) {
                alert('No turf specified');
                window.location.href = 'dashboard-player.html';
                return;
            }

            const turfs = appState.getTurfs();
            currentTurf = turfs.find(t => t.id === turfId);

            if (currentTurf) {
                document.getElementById('turfName').textContent = currentTurf.name;
                document.getElementById('turfLocation').textContent = currentTurf.location;
                document.getElementById('ratePerHour').textContent = `$${currentTurf.price}`;
                updateTotal();
            } else {
                alert('Turf not found');
            }
        }

        function updateTotal() {
            if (currentTurf) {
                const total = currentTurf.price + 2; // + service fee
                document.getElementById('totalPrice').textContent = `$${total.toFixed(2)}`;
            }
        }

        // Handle Payment
        function handlePayment(e) {
            e.preventDefault();

            if (!currentTurf) return;

            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const amount = (currentTurf.price + 2) * 100; // In paise

            const options = {
                "key": "rzp_test_PlaceHolder", // Enter the Key ID generated from the Dashboard
                "amount": amount,
                "currency": "USD",
                "name": "SportsConnect",
                "description": `Booking for ${currentTurf.name}`,
                "image": "https://via.placeholder.com/150",
                "handler": function (response) {
                    console.log('Payment Success:', response);

                    // Create Booking in State
                    // Assuming User ID is 'u1' for demo
                    appState.bookTurf('u1', turfId, date, time);

                    alert(`Payment Successful!\nPayment ID: ${response.razorpay_payment_id}`);
                    window.location.href = 'dashboard-player.html';
                },
                "prefill": {
                    "name": "John Doe",
                    "email": "john@example.com",
                    "contact": "9999999999"
                },
                "theme": {
                    "color": "#00ff88"
                }
            };

            const rzp1 = new Razorpay(options);

            rzp1.on('payment.failed', function (response) {
                alert(`Payment Failed!\nError: ${response.error.description}`);
            });

            rzp1.open();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadTurf);

    </script>
</body>

</html>