<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | SportsConnect</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <div class="logo">SPORTS<span>CONNECT</span> <span style="font-size:0.8rem; color:#ffcc00;">ADMIN</span></div>
        <div class="nav-links">
            <a href="index.html">Logout</a>
        </div>
    </nav>

    <main class="main-content" style="margin: 0; width: 100%; padding: 8rem 10%;">
        <h1>Pending Approvals</h1>
        <p style="color: var(--text-gray); margin-bottom: 2rem;">Review and approve coach certifications.</p>

        <div class="data-table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Certificate</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="coachesTable">
                    <!-- Loaded via JS -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', loadPendingCoaches);

        async function loadPendingCoaches() {
            try {
                const res = await fetch('/api/admin/pending-coaches');
                const data = await res.json();
                const tbody = document.getElementById('coachesTable');
                tbody.innerHTML = '';

                if (data.coaches.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No pending approvals</td></tr>';
                    return;
                }

                data.coaches.forEach(coach => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${coach.name}</td>
                        <td>${coach.email}</td>
                        <td>
                            <a href="/${coach.certificationPath}" target="_blank" class="text-link">View File</a>
                        </td>
                        <td>
                            <button onclick="approveCoach('${coach._id}')" class="btn btn-primary" style="padding:0.5rem 1rem; font-size:0.8rem;">Approve</button>
                            <button onclick="rejectCoach('${coach._id}')" class="btn btn-outline" style="padding:0.5rem 1rem; font-size:0.8rem; border-color: #ff3b30; color: #ff3b30;">Reject</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error loading coaches:', error);
            }
        }

        window.approveCoach = async (id) => {
            if (!confirm('Approve this coach?')) return;
            try {
                await fetch('/api/admin/approve-coach', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ coachId: id, action: 'approve' })
                });
                alert('Coach Approved');
                loadPendingCoaches();
            } catch (e) { alert('Error'); }
        };

        window.rejectCoach = async (id) => {
            if (!confirm('Reject this coach?')) return;
            try {
                await fetch('/api/admin/approve-coach', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ coachId: id, action: 'reject' })
                });
                alert('Coach Rejected');
                loadPendingCoaches();
            } catch (e) { alert('Error'); }
        };
    </script>
</body>

</html>